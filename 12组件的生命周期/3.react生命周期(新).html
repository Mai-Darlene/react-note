<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>react 生命周期（新）</title>
</head>
<body>
<div id="test"></div>

<!--引入React核心库-->
<script type="text/javascript" src="../js/17.0.2/react.development.js"></script>
<!--引入React-dom，用于支持react操作Dom-->
<script type="text/javascript" src="../js/17.0.2/react-dom.development.js"></script>
<!--引入babel，用于讲jsx转为js-->
<script type="text/javascript" src="../js/17.0.2/babel.js"></script>

<script type="text/babel"> /* 此处一定要写babel */
class Count extends React.Component{
    constructor(prop) {
        console.log('count---constructor')
        super(prop);
        //初始化state
        this.state = {
            count: 1
        }
    }

    //组件挂载后
    componentDidMount() {
        console.log('count---componentDidMount')
    }
    // 若state的值在任何时候都取决于props，那么可以使用getDerivedStateFromProps
    // static getDerivedStateFromProps(props,state) {
    //     console.log('count---getDerivedStateFromProps',props,state)
    //     return null
    // }
    add = () => {
        //获取原状态
        this.setState({count: this.state.count+1})
    }
    death = () => {
        ReactDOM.unmountComponentAtNode(document.getElementById('test'))
    }
    //强制更新按钮的回调
    force = () => {
        this.forceUpdate()
    }
    //组件将要卸载的钩子
    componentWillUnmount() {
        console.log('count---componentWillUnmount')
    }
    //控制组件更新的阀门
    shouldComponentUpdate() {
        console.log('count---shouldComponentUpdate')
        return true
    }
    //即将更新的钩子
    // UNSAFE_componentWillUpdate() {
    //     console.log('count---componentWillUpdate')
    // }
    //在更新完之前获取快照
    getSnapshotBeforeUpdate(){
        console.log('count---getSnapshotBeforeUpdate')
        return 'snapshot'
    }
    //更新完的钩子
    componentDidUpdate(preProps,preState,snapshotValue) {
        console.log('count---componentDidUpdate',preProps,preState)
    }
    // componentDidUnmount() {
    //     console.log('count---componentDidUnmount')
    // }
    render() {
        console.log('count---render')
        const {count} = this.state
        return(
            <div>
                <h2>当前求和为{count}</h2>
                <button onClick={this.add}>点我+1</button>
                <button onClick={this.death}>卸载组件</button>
                <button onClick={this.force}>不更改状态中的数据，强制更新</button>
            </div>
        )
    }
}

// ReactDOM.render(虚拟dom，容器)
ReactDOM.render(<Count count={199}/>, document.getElementById('test'))
</script>
</body>
</html>